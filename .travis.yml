sudo: false

repos:
  CRAN: http://cran.rstudio.com/

language: r

cache:
  packages: true

branches:
  only:
    - master

matrix:
  include:
    - name: "R"
      r: 3.2.3
      warnings_are_errors: true
      r_packages:
        - tibble
        - covr
      script:
        - |
          R CMD build --resave-data .
          R CMD check --no-build-vignettes --no-manual --no-tests pins*tar.gz
          Rscript ci/travis.R
      env:
        -TEST_GITHUB_BRANCH="travis"
      after_success:
        - rm -rf ~/.pins
        - Rscript -e 'covr::codecov()'
    - name: "Python (2.7)"
      r_packages:
        - feather
        - tibble
      before_install:
        - export LD_LIBRARY_PATH="/home/travis/R-bin/lib/R/lib:$LD_LIBRARY_PATH"
        - pip install pandas --user
        - pip install pytest --user
        - pip install feather-format --user
        - pip install -e python/. --user
      script:
        - R CMD build --no-build-vignettes .
        - Rscript -e 'install.packages(dir(".", pattern = "pins_"))'
        - pytest python/pins/tests/test.py
    - name: "Python (3.6)"
      r_packages:
        - feather
        - tibble
      before_install:
        - export LD_LIBRARY_PATH="/home/travis/R-bin/lib/R/lib:$LD_LIBRARY_PATH"
        - pip3 install setuptools --user
        - pip3 install pandas --user
        - pip3 install pytest --user
        - pip3 install feather-format --user
        - pip3 install -e python/. --user
      script:
        - R CMD build --no-build-vignettes .
        - Rscript -e 'install.packages(dir(".", pattern = "pins_"))'
        - pytest python/pins/tests/test.py
      addons:
        apt:
          update: true
          sources:
            - deadsnakes
          packages:
            - python3
            - python3-pip
os:
  - linux
